<!DOCTYPE HTML PUBLIC>
<html>
<head>
    <title>患者主诉实体链接标注系统</title>
</head>
<body>
    <center>
        <!-- to do: read samples from database -->
        <p id="sample">患者问句：医生您好！我的小腹为什么这么疼？</p>
        <button id="submit">
            submit
        </button>
    </center>
    <form name="myForm" id="myForm" onsubmit="return validateForm()">
    </form>
</body>
<script>
    var boundary = [];
    var innerOut = [];
    var funcGetSelectText = function(flag) {
        var txt = '';
        txt = document.getSelection();
        if (flag == 0) {
            boundary.push([txt.anchorOffset, txt.focusOffset]);
            innerOut.push([]);
        } else if (flag == 1) {
            innerOut[innerOut.length - 1].push([txt.anchorOffset, txt.focusOffset]);
        }
        return txt.toString();
    }
        
    function del(obj) {
        boundary.pop();
        innerOut.pop();
        element = event.srcElement;
        delNode = element.parentNode;
        delNode.remove(element);
    }
    
    var container = container || document;
    container.onmouseup = function() {
        var srcElement = event.srcElement;
        if (srcElement.tagName == "P") {
            var txt = funcGetSelectText(0);
            var form = document.getElementById("myForm");
            var li = document.createElement("li");
            form.appendChild(li);
            li.innerHTML = txt;

            var btn = document.createElement("button");
            btn.innerHTML = "X";
            btn.setAttribute("onclick", "del(this)");
            li.appendChild(btn);
        }
        else if (srcElement.tagName == "LI") {
            var txt = srcElement.innerHTML;
            var subtxt = funcGetSelectText(1);
            if (subtxt) {
                txt = txt.replace(subtxt, '<font color="gray">' + subtxt + "</font>");
                srcElement.innerHTML = txt;
            }
        }
        else if (srcElement.tagName == "BUTTON" && srcElement.id == "submit") {
            alert(innerOut);
            var center = document.getElementById("sample");
            center.innerHTML = "下一个";
        }
    }

    // to do list
    // 1. read knowledge graph, and then,
    //  recommend some candidates for entity linking labelling
    // 2. write labelled result to database
</script>
</html>